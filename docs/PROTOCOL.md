EXECUTION PROTOCOL & OUTPUT INTERPRETATION GUIDE

ZrMaps-statistical-analysis

This document provides a complete guide on how to run all processing scripts and a detailed explanation of all files and folders generated during the zircon-detection workflow.
It applies to micro-XRF, EPMA/WDS, SEM–EDS, µXRF scanners, and synchrotron XRF maps processed using the scripts of this repository.

## 0. Overview of Output Files and Their Meaning

When you process a sample (e.g., SAMPLE="TOB_7_100m_10TP"), the pipeline generates several folders and files inside:
SAMPLE/
    SAMPLE_mapas_tsv/
    SAMPLE_FRAC_clusters/
    SAMPLE_Zr_*_anomaly/
    SAMPLE_Zr_DBSCAN/
    SAMPLE_Zr_HDBSCAN/
    SAMPLE_Zr_alltests_report.pdf
    Each output has a specific scientific meaning.

⸻

0.1 JPG → TSV conversion (SAMPLE_mapas_tsv/)

Generated by: images_to_tsv_auto_delete.py

Produces:
	•	Si.tsv, Ti.tsv, Al.tsv, Fe.tsv, …, Zr.tsv
	•	Raw numerical matrices (no header)
	•	One file per elemental map

Purpose:
Provides a consistent numerical foundation for statistical and clustering analyses.

⸻

0.2 Multi-element phase classification (FRAC) (SAMPLE_FRAC_clusters/)

Generated by: frac_classification_auto.py

Contains:
	•	*_phase_mask.png — 15-phase KMeans mineral map
	•	*_phase_mask.tsv — cluster ID per pixel
	•	label_to_phase_map.csv / xlsx — FRAC centroids
	•	*_summary.txt — brief mineral interpretation

Purpose:
Provides a chemical segmentation of the entire scanned area, identifying potential host minerals around zircon.

⸻

0.3 Statistical detection of Zr anomalies (SAMPLE_Zr_*_anomaly/)

Generated by: zircon_zr_alltests_FULL.py

Methods included:
	•	IQR
	•	MAD
	•	Z-score
	•	GMM (Gaussian Mixture Modelling)
	•	Adaptive Percentiles
	•	Local MAD

Each method produces a folder:
SAMPLE_Zr_IQR_anomaly/
SAMPLE_Zr_MAD_anomaly/
SAMPLE_Zr_Zscore_anomaly/
SAMPLE_Zr_GMM_anomaly/
SAMPLE_Zr_Adaptive_anomaly/
SAMPLE_Zr_LocalMAD_anomaly/
Inside each folder:
	•	Linear Zr anomaly map (PNG)
	•	Log10(Zr) anomaly map (PNG)
	•	Histogram of thresholds
	•	TSV anomaly matrix (0–4 scale):
	•	0 = no zircon
	•	1 = dubious zircon
	•	2 = possible zircon
	•	3 = highly probable zircon
	•	4 = zircon
	•	CSV summary
	•	Method explanation *_stats.txt

Purpose:
Performs statistical outlier detection of Zr enrichment under multiple hypothesis models.

⸻

0.4 Density-based clustering: DBSCAN & HDBSCAN

Generated by: zircon_zr_DBSCAN_HDBSCAN.py

Files produced in:
SAMPLE_Zr_DBSCAN/
SAMPLE_Zr_HDBSCAN/
Contents:
	•	*_cluster_map.png — cluster spatial distribution
	•	*_cluster_matrix.tsv — pixel-wise cluster ID
	•	*_classes.png — zircon-likeness (0–4 scale)
	•	Histogram of cluster intensities
	•	*_stats.txt — explanation of core/edge points, cluster density, and zircon interpretation

Purpose:
Detects geometric clusters of zircon grains, aggregates, and zoning patterns.

⸻

0.5 Multi-page PDF report (SAMPLE_Zr_alltests_report.pdf)

Generated by: zircon_zr_alltests_FULL.py

Includes:
	1.	Original Zr map (linear + log)
	2.	Combined panels of all 6 statistical methods
	3.	Histograms and thresholds
	4.	Comparison of statistical outputs
	5.	Recommendations for interpretation

Purpose:
Ideal for reports, publication supplements, and exploratory analysis.
———————————–

## 1. macOS (Terminal)

———————————–

1.1 Initial Setup (run once)
mkdir -p ~/Desktop/micro_XRF
cd ~/Desktop/micro_XRF
python3 -m pip install --upgrade pip setuptools wheel
python3 -m pip install numpy matplotlib scikit-learn hdbscan pillow openpyxl
If HDBSCAN fails:
brew install cmake gcc llvm
HDBSCAN_NO_AVX=1 python3 -m pip install hdbscan
1.2 Workflow for Each Sample

(1) Define sample
SAMPLE="MySample"
mkdir -p "$SAMPLE"
(2) Convert JPG → TSV
python3 images_to_tsv_auto_delete.py "$SAMPLE"
(3) FRAC classification (15 mineral phases)
python3 frac_classification_auto.py "$SAMPLE"
(4) Full statistical Zr detection
python3 zircon_zr_alltests_FULL.py "$SAMPLE"
(5) DBSCAN + HDBSCAN clustering
python3 zircon_zr_DBSCAN_HDBSCAN.py "$SAMPLE"
———————————–

## 2. Windows CMD

———————————–
